const browserAPI="undefined"!=typeof browser?browser:chrome;browserAPI||console.error("[Topic Manager] Browser API (chrome or browser) not available. Background script will not function."),browserAPI.runtime.onMessage.addListener(((e,o,s)=>"UPDATE_STATS"===e.type?(browserAPI.storage.local.get(["topicsByConversation","messageBookmarksByConversation"],(e=>{const o=e.topicsByConversation||{},r=e.messageBookmarksByConversation||{},t=Object.values(o).reduce(((e,o)=>e+(Array.isArray(o)?o.length:0)),0),i=Object.values(r).reduce(((e,o)=>e+Object.keys(o||{}).length),0);s({topics:t,messages:i})})),!0):"SAVE_SETTINGS"===e.type?(browserAPI.storage.local.set(e.settings,(()=>{browserAPI.tabs.query({active:!0,currentWindow:!0},(o=>{o[0]?.id&&browserAPI.tabs.sendMessage(o[0].id,{type:"settings-updated",settings:e.settings})})),s({success:!0})})),!0):"LOAD_SETTINGS"===e.type?(browserAPI.storage.local.get(["autoTopic","topicPosition"],(e=>{s({autoTopic:e.autoTopic||"enabled",topicPosition:e.topicPosition||"right"})})),!0):void 0));